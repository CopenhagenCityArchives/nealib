<Window x:Class="HardHorn.Views.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:HardHorn"
        xmlns:cal="http://www.caliburnproject.org"
        xmlns:vm="clr-namespace:HardHorn.ViewModels"
        xmlns:ctl="clr-namespace:HardHorn.Controls"
        mc:Ignorable="d"
        Title="HardHorn" Height="720" Width="1280"
        Background="{StaticResource {x:Static SystemColors.ControlLightBrushKey}}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"></RowDefinition>
            <RowDefinition Height="Auto"></RowDefinition>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Column 0 -->
        <Grid Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Label FontWeight="Bold">Vælg arkiveringsversion</Label>

            <DockPanel Grid.Row="1">
                <Button DockPanel.Dock="Right" Width="30" cal:Message.Attach="SelectLocation(LocationTextBox)">...</Button>
                <TextBox DockPanel.Dock="Left" x:Name="LocationTextBox" Grid.Row="1" Text="{Binding TestLocation}"></TextBox>
            </DockPanel>

            <DockPanel Grid.Row="2">
                <Button DockPanel.Dock="Left" MinWidth="120" cal:Message.Attach="LoadTables()">Indlæs tabelindex</Button>
                <Button DockPanel.Dock="Right" IsEnabled="{Binding TestLoaded}" cal:Message.Attach="ToggleTest()">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Content" Value="Begynd test" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TestRunning}" Value="True">
                                    <Setter Property="Content" Value="Stop test"></Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

            </DockPanel>

            <Grid Grid.Row="3">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Label Grid.Row="0" FontWeight="Bold">Vælg tests</Label>

                <TreeView Grid.Row="1" ItemsSource="{Binding TestSuite}" MinHeight="200">
                    <TreeView.Resources>
                        <HierarchicalDataTemplate DataType="{x:Type vm:TestSuiteCategory}" ItemsSource="{Binding TestTypes}">
                            <CheckBox IsChecked="{Binding Selected}" Content="{Binding Name}" />
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type vm:TestSuiteTestType}" ItemsSource="{Binding DataTypeTests}">
                            <CheckBox IsChecked="{Binding Selected}" Content="{Binding TestType, Converter={StaticResource AnalysisErrorTypeToStringConverter}}" />
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type vm:TestSuiteDataTypeTest}">
                            <CheckBox IsChecked="{Binding Selected}" Content="{Binding DataType}" />
                        </HierarchicalDataTemplate>
                    </TreeView.Resources>
                </TreeView>

                <Label Grid.Row="2" FontWeight="Bold">Regulære udtryk</Label>
                <Grid Grid.Row="3">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"  />
                        <RowDefinition Height="Auto"  />
                        <RowDefinition Height="Auto"  />
                        <RowDefinition Height="*"  />
                        <RowDefinition Height="Auto"  />
                        <RowDefinition Height="*"  />
                        <RowDefinition Height="*"  />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Label Grid.Row="0">Tabel:</Label>
                    <ComboBox Grid.Row="0" x:Name="RegexTableListBox" Grid.Column="1" Height="22" ItemsSource="{Binding Tables}" ItemTemplate="{StaticResource RegexTableTemplate}" />
                    <Label Grid.Row="1">Kolonne:</Label>
                    <ComboBox x:Name="RegexColumnListBox" Grid.Column="1" Grid.Row="1" ItemsSource="{Binding Path=SelectedItem.Table.Columns, ElementName=RegexTableListBox}" ItemTemplate="{StaticResource RegexColumnTemplate}" />
                    <Label Grid.Row="2">Udtryk:</Label>
                    <TextBox x:Name="RegexTextBox" FontFamily="Consolas" Grid.Column="1" Grid.Row="2" HorizontalAlignment="Stretch" />
                    <Button Grid.Row="3" Grid.ColumnSpan="2" cal:Message.Attach="AddRegex(RegexTextBox.Text, RegexColumnListBox.SelectedItem)">Tilføj</Button>
                    <ListBox x:Name="RegexListBox" Grid.Row="4" Grid.ColumnSpan="2" ItemsSource="{Binding Regexes}" ItemTemplate="{StaticResource RegexItemTemplate}" Height="150"></ListBox>
                    <Button Grid.Row="5" Grid.ColumnSpan="2" cal:Message.Attach="RemoveRegex(RegexListBox.SelectedItem)">Fjern</Button>
                </Grid>
            </Grid>
        </Grid>

        <TabControl Margin="5" Grid.Column="1">
            <TabItem Header="Interaktiv visning">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="250" Width="Auto" />
                        <ColumnDefinition Width="5" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" MaxHeight="50"></RowDefinition>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <WrapPanel Grid.Column="2" Orientation="Horizontal">
                        <TextBlock FontWeight="Black" Text="{Binding CurrentTable.Table.Name}"></TextBlock>
                        <TextBlock TextWrapping="Wrap" Margin="5 0 0 0" FontStyle="Italic" Text="{Binding CurrentTable.Table.Description}"></TextBlock>
                    </WrapPanel>
                    <ListBox Grid.RowSpan="3" DockPanel.Dock="Left" ItemsSource="{Binding Tables}" SelectedItem="{Binding CurrentTable, Mode=OneWayToSource}" ItemContainerStyle="{StaticResource TableListContainerStyle}"></ListBox>
                    <GridSplitter Grid.Row="1" Grid.Column="1" Width="5" HorizontalAlignment="Stretch"></GridSplitter>
                    <TreeView Grid.Row="1" x:Name="ReportTreeView" Grid.Column="2" DockPanel.Dock="Right" ItemsSource="{Binding TableReports, Mode=OneWay}" ItemContainerStyle="{StaticResource ReportTreeContainerStyle}"></TreeView>
                    <WrapPanel Grid.Row="2" Grid.Column="2" Margin="5">
                        <CheckBox IsChecked="{Binding ShowErrorReports}" Margin="0 0 10 0">Vis fejl</CheckBox>
                        <CheckBox IsChecked="{Binding ShowSuggestionReports}" Margin="0 0 10 0">Vis forslag</CheckBox>
                        <CheckBox IsChecked="{Binding ShowEmptyReports}" Margin="0 0 10 0">Vis resten</CheckBox>
                    </WrapPanel>
                </Grid>
            </TabItem>

            <TabItem Header="Statistik">
                <ScrollViewer>
                    <ItemsControl ItemsSource="{Binding DataTypeStatistics}" ItemTemplate="{StaticResource StatisticsItemTemplate}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Status Log">
                <DockPanel>
                    <Button Width="50" DockPanel.Dock="Bottom" cal:Message.Attach="SaveLog()">Gem log</Button>
                    <Button Width="50" DockPanel.Dock="Bottom" cal:Message.Attach="ClearLog()">Slet log</Button>
                    <ListView ItemsSource="{Binding LogItems}" DockPanel.Dock="Top">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Tidspunkt" DisplayMemberBinding="{Binding Item2, StringFormat={}{0:HH:MM:ss}}" />
                                <GridViewColumn Width="800" Header="Status" CellTemplate="{StaticResource LogListStatusCellTemplate}" />
                            </GridView>
                        </ListView.View>
                    </ListView>
                </DockPanel>

            </TabItem>
        </TabControl>
        <ProgressBar Grid.Row="3" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Value="{Binding TestProgress}"/>
        <Label Grid.Row="3" Grid.Column="1" Content="{Binding StatusText}"/>
    </Grid>
</Window>
